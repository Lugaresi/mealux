# Description: A virtual machine designed for executing programs written in Hack and PHP
# URL:         https://github.com/facebook/hhvm
# Maintainer:  Lugaresi
# Depends on:  cmake libxml2 bison gawk git boost bzip2 curl elfutils sqlite3 libxslt libgd glog libinotify mysql libevent libzip tbb oniguruma libedit libdwarf imagemagick fribidi libiconv libmcrypt libmemcached krb5 openldap jemalloc

name=hhvm
version=3.24.3
release=1

source=(http://dl.hhvm.com/source/hhvm-$version.tar.gz \
	folly322.diff libxml-hack.diff\
        server.ini php.ini hhvm)

build() {
    cd hhvm-$version
    patch -p1 -i $SRC/dwarfhack.diff
    patch -p1 -i $SRC/libxml-hack.diff
    mkdir build && cd build
    cmake -DCMAKE_INSTALL_PREFIX=/usr ..
    make
    make DESTDIR=$PKG install
    mv $PKG/usr/lib64 $PKG/usr/lib
    mkdir -p $PKG/etc/hhvm
    install -m 755 $SRC/server.ini $PKG/etc/hhvm/
    install -m 755 $SRC/php.ini $PKG/etc/hhvm/
    mkdir -p $PKG/etc/rc.d
    install -m 755 $SRC/hhvm $PKG/etc/rc.d
}
