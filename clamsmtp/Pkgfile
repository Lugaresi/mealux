# Description: SMTP filter that allows you to check for viruses using the ClamAV anti-virus software.
# URL:         http://thewalter.net/stef/software/clamsmtp/
# Maintainer:  Lugaresi
# Depends on:  clamav

name=clamsmtp
version=1.10
release=1
source=($name-$version.tar.gz clamsmtp.rc smtppass-fix-include-order.diff)

build() {
    cd $name-$version
    ./configure --prefix=/usr --sbindir=/usr/sbin
    patch -p1 -i $SRC/smtppass-fix-include-order.diff
    sed -i 's@#define DEFAULT_CLAMAV "/var/run/clamav/clamd"@#define DEFAULT_CLAMAV "/var/run/clamav/clamd.sock"@g' src/clamsmtpd.c
    make
    make DESTDIR=$PKG install
    mkdir -p $PKG/etc/clamav
    install -m 644 $SRC/$name-$version/doc/clamsmtpd.conf $PKG/etc/clamav/
    sed -i 's/#User: clamav/User: clamav/g' $PKG/etc/clamav/clamsmtpd.conf
    sed -i 's/#ClamAddress: \/var\/run\/clamav\/clamd/ClamAddress: \/var\/run\/clamav\/clamd.sock/g' $PKG/etc/clamav/clamsmtpd.conf
    mkdir -p $PKG/etc/rc.d
    install -m 755 $SRC/clamsmtp.rc $PKG/etc/rc.d/clamsmtp
}
